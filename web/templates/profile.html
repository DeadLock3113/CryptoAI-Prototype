{% extends "layout.html" %}

{% block title %}Profilo{% endblock %}

{% block page_header %}Profilo Utente{% endblock %}

{% block page_description %}
Gestisci il tuo profilo e visualizza la tua attività recente
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-4">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Informazioni Personali</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-center mb-4">
                    <div class="avatar-placeholder bg-secondary rounded-circle d-flex justify-content-center align-items-center" style="width: 100px; height: 100px;">
                        <i class="fas fa-user fa-3x text-white"></i>
                    </div>
                </div>
                
                <form method="POST" action="{{ url_for('profile') }}">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username" value="{{ current_user.username }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" value="{{ current_user.email }}" required>
                    </div>
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            Salva Modifiche
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">Modifica Password</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('change_password') }}">
                    <div class="mb-3">
                        <label for="current_password" class="form-label">Password Attuale</label>
                        <input type="password" class="form-control" id="current_password" name="current_password" required>
                    </div>
                    <div class="mb-3">
                        <label for="new_password" class="form-label">Nuova Password</label>
                        <input type="password" class="form-control" id="new_password" name="new_password" required>
                    </div>
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Conferma Nuova Password</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-key me-2"></i>
                            Cambia Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Attività Recenti</h5>
            </div>
            <div class="card-body">
                {% if datasets %}
                <h6 class="card-title">Dataset</h6>
                <div class="table-responsive mb-4">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Simbolo</th>
                                <th>Data Inizio</th>
                                <th>Data Fine</th>
                                <th>Creato il</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dataset in datasets %}
                            <tr>
                                <td>{{ dataset.name }}</td>
                                <td>{{ dataset.symbol }}</td>
                                <td>{{ dataset.start_date }}</td>
                                <td>{{ dataset.end_date }}</td>
                                <td>{{ dataset.created_at }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Non hai ancora caricato dataset. <a href="{{ url_for('upload') }}">Carica il tuo primo dataset</a>.
                </div>
                {% endif %}
                
                {% if backtests %}
                <h6 class="card-title">Backtest Recenti</h6>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Strategia</th>
                                <th>Rendimento</th>
                                <th>Sharpe Ratio</th>
                                <th>Creato il</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for backtest in backtests %}
                            <tr>
                                <td>{{ backtest.name }}</td>
                                <td>{{ backtest.strategy.name }}</td>
                                <td>{{ (backtest.total_return * 100)|round(2) }}%</td>
                                <td>{{ backtest.sharpe_ratio|round(2) }}</td>
                                <td>{{ backtest.created_at }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Non hai ancora eseguito backtest. <a href="{{ url_for('backtest') }}">Esegui il tuo primo backtest</a>.
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Statistiche</h5>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="border rounded p-3 text-center h-100">
                            <i class="fas fa-database fa-2x mb-2 text-primary"></i>
                            <h3>{{ datasets|length if datasets else 0 }}</h3>
                            <p class="mb-0">Dataset</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="border rounded p-3 text-center h-100">
                            <i class="fas fa-chart-line fa-2x mb-2 text-success"></i>
                            <h3>{{ backtests|length if backtests else 0 }}</h3>
                            <p class="mb-0">Backtest</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="border rounded p-3 text-center h-100">
                            <i class="fas fa-brain fa-2x mb-2 text-warning"></i>
                            <h3>{{ models|length if models else 0 }}</h3>
                            <p class="mb-0">Modelli ML</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}