{% extends "layout.html" %}

{% block title %}Backtest Strategies{% endblock %}

{% block page_header %}Backtest Trading Strategies{% endblock %}

{% block page_description %}
Test your trading strategies on historical data with realistic simulations
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Strategy Configuration</h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('backtest') }}" method="post">
                    <div class="mb-4">
                        <label for="strategy_type" class="form-label">Select Strategy</label>
                        <select class="form-select" id="strategy_type" name="strategy_type">
                            {% for strategy in strategy_options %}
                            <option value="{{ strategy.id }}">{{ strategy.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div id="crossover-params">
                        <h5 class="mb-3">Moving Average Crossover Parameters</h5>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="fast_ma" class="form-label">Fast MA Period</label>
                                <input type="number" class="form-control" id="fast_ma" name="fast_ma" value="20" min="1" max="200">
                                <div class="form-text">Shorter period moving average</div>
                            </div>
                            <div class="col-md-4">
                                <label for="slow_ma" class="form-label">Slow MA Period</label>
                                <input type="number" class="form-control" id="slow_ma" name="slow_ma" value="50" min="2" max="500">
                                <div class="form-text">Longer period moving average</div>
                            </div>
                            <div class="col-md-4">
                                <label for="ma_type" class="form-label">MA Type</label>
                                <select class="form-select" id="ma_type" name="ma_type">
                                    <option value="sma">Simple MA (SMA)</option>
                                    <option value="ema">Exponential MA (EMA)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <h5 class="mb-3">Backtest Settings</h5>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="initial_capital" class="form-label">Initial Capital ($)</label>
                            <input type="number" class="form-control" id="initial_capital" name="initial_capital" value="10000" min="100">
                        </div>
                        <div class="col-md-6">
                            <label for="commission" class="form-label">Commission (%)</label>
                            <input type="number" class="form-control" id="commission" name="commission" value="0.1" min="0" max="10" step="0.01">
                            <div class="form-text">Enter as percentage (e.g., 0.1 for 0.1%)</div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sync-alt me-2"></i>
                            Run Backtest
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Strategy Information
                </h5>
            </div>
            <div class="card-body">
                <div id="strategy-description">
                    <h5>Moving Average Crossover</h5>
                    <p>The Moving Average Crossover strategy generates trading signals based on the crossing of a fast moving average and a slow moving average.</p>
                    
                    <ul>
                        <li><strong>Buy Signal:</strong> When the fast MA crosses above the slow MA</li>
                        <li><strong>Sell Signal:</strong> When the fast MA crosses below the slow MA</li>
                    </ul>
                    
                    <p>This strategy works well in trending markets but may generate false signals in sideways markets.</p>
                </div>
            </div>
        </div>
        
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-lightbulb me-2"></i>
                    Backtesting Tips
                </h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <i class="fas fa-check text-success me-2"></i>
                        Use realistic commission rates
                    </li>
                    <li class="list-group-item">
                        <i class="fas fa-check text-success me-2"></i>
                        Test strategies over different market conditions (bull, bear, sideways)
                    </li>
                    <li class="list-group-item">
                        <i class="fas fa-check text-success me-2"></i>
                        Compare results to a buy-and-hold baseline
                    </li>
                    <li class="list-group-item">
                        <i class="fas fa-check text-success me-2"></i>
                        Examine risk-adjusted metrics (Sharpe, Sortino) not just returns
                    </li>
                </ul>
            </div>
        </div>
        
        {% if has_indicators %}
        <div class="alert alert-success">
            <i class="fas fa-check-circle me-2"></i>
            <strong>Technical indicators are available</strong> and will be used in the backtest.
        </div>
        {% else %}
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>No technical indicators have been calculated.</strong> Basic indicators will be calculated automatically.
            <div class="mt-2">
                <a href="{{ url_for('indicators') }}" class="btn btn-sm btn-primary">
                    Calculate Indicators
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const strategySelect = document.getElementById('strategy_type');
        const strategyDescription = document.getElementById('strategy-description');
        const crossoverParams = document.getElementById('crossover-params');
        
        strategySelect.addEventListener('change', function() {
            const strategy = strategySelect.value;
            
            // Show/hide strategy-specific parameters
            if (strategy === 'crossover') {
                crossoverParams.style.display = 'block';
                strategyDescription.innerHTML = `
                    <h5>Moving Average Crossover</h5>
                    <p>The Moving Average Crossover strategy generates trading signals based on the crossing of a fast moving average and a slow moving average.</p>
                    
                    <ul>
                        <li><strong>Buy Signal:</strong> When the fast MA crosses above the slow MA</li>
                        <li><strong>Sell Signal:</strong> When the fast MA crosses below the slow MA</li>
                    </ul>
                    
                    <p>This strategy works well in trending markets but may generate false signals in sideways markets.</p>
                `;
            } else {
                // For future strategies
                crossoverParams.style.display = 'none';
            }
        });
        
        // Set initial state
        strategySelect.dispatchEvent(new Event('change'));
    });
</script>
{% endblock %}
